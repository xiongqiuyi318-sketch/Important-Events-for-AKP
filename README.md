# 欢迎使用你的秒哒应用代码包
秒哒应用链接
    URL:https://www.miaoda.cn/projects/app-7tmonjxut1q9

# 重要事件管理应用

这是一个基于 Taro + React + TypeScript 的跨平台应用项目，用于管理重要事件和任务，具备智能步骤生成功能。支持编译为**网页应用（H5）**和**微信小程序**。

## 📖 文档导航

- **[快速开始指南](./QUICKSTART.md)** - 5 分钟快速部署
- **[详细部署指南](./DEPLOYMENT.md)** - 完整的部署和配置说明
- **[网页应用特性](./WEB_APP_FEATURES.md)** - 网页应用的特性和优势
- **[开发任务清单](./TODO.md)** - 项目开发进度

## 应用类型

本项目支持两种运行模式：

### 🌐 网页应用（H5）
- 可在任何现代浏览器中运行
- 支持桌面和移动设备访问
- 响应式设计，自适应不同屏幕尺寸
- 完整的事件管理功能

### 📱 微信小程序
- 可在微信中运行
- 原生小程序体验
- 支持小程序特有功能

## 项目特性

### 核心功能
- **智能步骤生成与实时预览**：创建事件时自动生成执行步骤，并实时显示预览
- **手动添加步骤**：在智能生成的步骤预览中，可以在任意步骤后手动添加新步骤
- **备注智能解析**：系统识别备注中的步骤列表，自动转换为任务清单
- **描述驱动的步骤生成**：在事件详情页编辑描述，根据新描述重新生成步骤
- **步骤与描述双向同步**：步骤自动同步到描述，可在描述中手动添加或删减步骤
- **发货流程管理**：专门的发货类别，自动生成完整的货运单证流程步骤
- **进口流程管理**：专门的进口类别，自动生成从签字到收货的完整进口流程步骤
- **机械维修管理**：专门的机械维修类别，自动生成从诊断到归档的完整维修流程步骤
- **本地销售管理**：专门的本地销售类别，自动生成delivery note制作、record管理和月度结算流程步骤
- **事件管理**：创建、编辑、删除事件，支持优先级和截止时间设置
- **开始时间和提醒**：可为待办事件设置开始时间（年/月/日/时/分），并选择提醒方式（铃声或振动）
- **事件排序**：按优先级自动排列，支持在同一优先级内手动调整顺序
- **快速定位**：点击统计卡片（待办、进行中、已完成）快速定位到对应事件
- **编辑事件增强**：可编辑事件名称、分类、优先级、开始时间、提醒方式等所有字段
- **步骤管理**：查看、编辑、完成、删除步骤，已完成步骤显示删除线效果
- **步骤状态管理**：为每个步骤添加自定义状态描述，如"进行中"、"等待审批"等
- **进度可视化**：实时显示事件完成进度和统计数据
- **历史记录**：查看已完成事件，按月份分组展示
- **一键退出编辑**：编辑事件时可一键退出，智能询问是否保存修改
- **每月自动提醒**：每月自动检测上月创建的事件，询问用户是否删除，帮助保持事件列表整洁

### 设计特性
- **小清新界面风格**：采用柔和的渐变背景和圆润的卡片设计
- **首页**：浅蓝色渐变背景，清新明快的视觉效果
- **历史页面**：温暖的黄色渐变背景，营造成就感氛围
- **精致的卡片设计**：圆角卡片、柔和阴影、丰富的图标元素
- **直观的视觉反馈**：彩色标签、状态图标、进度展示

### 技术特性
- **跨平台支持**：同一套代码可编译为网页应用（H5）和微信小程序
- **Taro 框架**：基于 Taro 4.x，支持多端统一开发
- **现代技术栈**：React 18 + TypeScript + Tailwind CSS
- **后端服务**：使用 Supabase 作为后端数据库和认证服务
- **用户认证**：支持手机号/邮箱登录，数据隔离
- **响应式设计**：自适应不同屏幕尺寸，优化移动端和桌面端体验
- **智能算法**：基于事件类型和描述的智能步骤生成

## 项目结构

```
├── src/
│   ├── app.config.ts               # Taro 应用配置，定义路由和 tabBar
│   ├── app.scss                    # 全局样式和设计系统变量
│   ├── app.tsx                     # 应用入口文件
│   ├── client/
│   │   └── supabase.ts             # Supabase 客户端配置
│   ├── db/                         # 数据库操作层
│   │   ├── api.ts                  # 数据库 API 函数
│   │   ├── types.ts                # TypeScript 类型定义
│   │   ├── stepGenerator.ts        # 智能步骤生成逻辑
│   │   └── supabase.ts             # Supabase 客户端
│   ├── pages/                      # 页面组件
│   │   ├── home/                   # 首页（事件列表）
│   │   ├── history/                # 历史记录页
│   │   ├── create-event/           # 创建事件页
│   │   ├── event-detail/           # 事件详情页
│   │   ├── add-step/               # 添加步骤页
│   │   └── login/                  # 登录页
│   └── assets/
│       └── images/                 # 图标资源
└── supabase/
    └── migrations/                 # 数据库迁移文件
        └── 01_create_events_and_steps_tables.sql
```

## 数据库设计

### events 表（事件表）
- 存储用户创建的重要事件
- 包含标题、描述、优先级、状态、截止时间等字段
- 支持分类标签
- 支持开始时间（start_time）和提醒方式（reminder_type）设置
- 提醒方式：铃声（sound）或振动（vibrate）

### steps 表（步骤表）
- 存储事件的执行步骤
- 支持排序、完成状态跟踪
- 标记是否为自动生成的步骤
- 支持自定义状态描述（status 字段）

### step_templates 表（步骤模板表）
- 存储预定义的步骤模板
- 用于智能步骤生成
- 包含关键词匹配和优先级
- 支持的分类：会议准备、项目开发、活动策划、学习计划、发货、进口、机械维修、本地销售、通用任务

## 智能步骤生成

系统支持三种步骤生成方式：

1. **备注解析**：识别备注中的列表格式（如 "1. xxx"、"- xxx"），自动转换为步骤
2. **模板匹配**：根据事件标题、分类和关键词匹配预定义模板
3. **默认步骤**：如果无法匹配，生成通用的执行步骤框架

### 实时预览功能

在创建事件页面，当您输入事件标题和描述后：
- 系统会自动分析内容并生成步骤预览
- 预览区域实时显示将要创建的步骤列表
- 步骤会在事件创建后自动添加到数据库
- 可选择设置开始时间（年/月/日/时/分）
- 可选择提醒方式（铃声或振动）

### 步骤完成状态

在事件详情页面：
- 点击步骤前的圆形图标可以标记步骤为已完成
- 已完成的步骤会显示删除线效果，便于区分
- 进度条实时更新显示完成百分比
- 显示事件的开始时间和提醒方式（如已设置）

## 页面路由

- `/pages/home/index` - 首页（事件列表）
- `/pages/history/index` - 历史记录
- `/pages/create-event/index` - 创建事件
- `/pages/event-detail/index` - 事件详情
- `/pages/add-step/index` - 添加步骤
- `/pages/login/index` - 登录页

## 安装和使用

```bash
# 安装依赖
pnpm install

# 代码检查
pnpm run lint
```

## 使用指南

### 创建事件并查看步骤预览

1. 在首页点击"创建事件"按钮
2. 输入事件标题，例如："准备年度总结会议"
3. 在描述框中输入详细信息，可以使用列表格式：
   ```
   1. 收集各部门数据
   2. 制作PPT演示文稿
   3. 预定会议室
   4. 发送会议通知
   ```
4. 系统会自动在下方显示"智能生成步骤预览"
5. 预览区域会实时展示将要创建的步骤列表
6. 点击"创建事件"按钮完成创建

### 在预览中手动添加步骤

在创建事件时，您可以在智能生成的步骤预览中手动添加额外的步骤：

1. **查看智能生成的步骤**：输入标题和描述后，系统会自动生成步骤预览
2. **添加新步骤**：
   - **在第一个步骤前添加**：点击第一个步骤上方的"在此步骤前添加"按钮
   - **在任意步骤前添加**：点击步骤下方的"在此步骤前添加"按钮
   - **在任意步骤后添加**：点击步骤下方的"在此步骤后添加"按钮
   - 输入新步骤的标题
   - 点击"确认添加"按钮
   - 新步骤会插入到选定的位置
3. **删除手动添加的步骤**：
   - 手动添加的步骤会显示橙色标记和"手动添加"标签
   - 点击步骤右侧的删除图标即可删除
4. **视觉区分**：
   - 蓝色圆圈：智能生成的步骤
   - 橙色圆圈：手动添加的步骤

**使用场景**：
- 智能生成的步骤不够完整，需要补充额外步骤
- 某个步骤需要细分为多个子步骤
- 在步骤序列的任意位置插入新步骤
- 根据实际情况调整步骤顺序和内容

**提示**：手动添加的步骤和智能生成的步骤会一起保存到数据库，功能完全相同。

### 在事件详情页添加步骤（指定位置）

在事件详情页面，您可以添加新步骤并指定插入位置：

1. 在事件详情页面点击"添加步骤"按钮
2. 在添加步骤页面，您会看到：
   - **插入位置选择器**：选择新步骤要插入的位置
   - **当前步骤列表**：显示事件的所有现有步骤
   - 步骤标题和描述输入框

3. **选择插入位置**：
   - 点击"插入位置"选择器
   - 可选择的位置包括：
     - 第 1 步（最前面）
     - 第 2 步
     - 第 3 步
     - ...
     - 第 N 步（最后）
   - 默认选择最后一个位置

4. **查看当前步骤**：
   - 页面会显示当前所有步骤的列表
   - 每个步骤显示序号和标题
   - 帮助您决定在哪个位置插入新步骤

5. 输入步骤标题和描述（可选）
6. 点击"添加步骤"按钮
7. 系统会：
   - 在指定位置插入新步骤
   - 自动调整其他步骤的顺序
   - 同步更新事件描述
   - 返回事件详情页

**使用场景**：
- 在步骤序列的开头添加准备工作
- 在两个步骤之间插入遗漏的步骤
- 在特定步骤后添加检查或验证步骤
- 根据实际执行情况调整步骤顺序

**提示**：
- 插入新步骤后，所有步骤的序号会自动更新
- 步骤顺序的变化会同步到事件描述中
- 可以随时添加更多步骤，不限制数量

### 管理步骤完成状态

在事件详情页面，您可以通过两种方式标记步骤为已完成：

#### 方式一：点击步骤前的圆形图标

1. 在首页点击事件卡片进入详情页
2. 在"执行步骤"区域，每个步骤前都有一个圆形图标
3. 点击圆形图标可以切换步骤的完成状态
4. 已完成的步骤会：
   - 显示绿色对勾图标
   - 标题文字显示删除线效果
   - 整体透明度降低

#### 方式二：点击"已完成"按钮

1. 在事件详情页面的"执行步骤"区域
2. 每个未完成的步骤下方都有操作按钮
3. 点击绿色的"已完成"按钮
4. 步骤会立即标记为已完成，显示效果同上
5. 已完成的步骤不再显示"已完成"按钮

**视觉效果**：
- 未完成步骤：显示步骤序号，正常显示文字
- 已完成步骤：显示绿色对勾，文字带删除线，整体变灰

**进度追踪**：
- 页面顶部的进度条会实时更新完成百分比
- 统计信息会显示"已完成 X / 总共 Y"

### 编辑步骤

在事件详情页面，您可以编辑步骤的标题：

1. 在事件详情页面的"执行步骤"区域
2. 每个步骤下方都有"编辑步骤"按钮
3. 点击"编辑步骤"按钮后：
   - 会显示步骤标题输入框
   - 可以修改步骤的标题内容
4. 输入完成后点击"保存"按钮保存修改
5. 点击"取消"按钮可以放弃修改

**使用场景**：
- 修正步骤标题的错误或不准确之处
- 根据实际情况调整步骤描述
- 优化步骤表达，使其更清晰明确

**提示**：
- 修改步骤标题后会自动同步到事件描述
- 步骤标题不能为空

### 编辑步骤状态

在事件详情页面，您可以为每个步骤添加自定义状态描述：

1. 在事件详情页面的"执行步骤"区域
2. 每个步骤下方都有"编辑状态"按钮
3. 点击"编辑状态"按钮后：
   - 会显示状态输入框
   - 可以输入自定义状态描述（最多50个字符）
   - 例如："进行中"、"等待审批"、"已暂停"、"需要协助"等
4. 输入完成后点击"确认"按钮保存
5. 点击"取消"按钮可以放弃修改

**状态显示**：
- 已设置状态的步骤会在标题下方显示状态信息
- 状态信息以蓝色背景的卡片形式展示
- 带有信息图标，便于识别

**使用场景**：
- 记录步骤的当前执行状态
- 标注步骤遇到的问题或阻碍
- 说明步骤需要等待的条件
- 添加步骤的进展备注

**提示**：
- 状态信息是可选的，不影响步骤的完成标记
- 可以随时修改或清空状态信息
- 状态信息独立于步骤的完成状态

### 删除事件

您可以在首页或历史页面删除不需要的事件：

#### 在首页删除待办事件

1. 在首页的待办事件列表中，找到要删除的事件
2. 点击事件卡片底部的"删除"按钮
3. 在弹出的确认对话框中点击"删除"按钮
4. 事件将被永久删除，无法恢复

#### 在历史页面删除已完成事件

1. 切换到"历史"标签页
2. 在已完成事件列表中，找到要删除的事件
3. 点击事件卡片右下角的"删除"按钮
4. 在弹出的确认对话框中点击"删除"按钮
5. 事件将被永久删除，无法恢复

**注意事项**：
- 删除事件会同时删除该事件的所有步骤
- 删除操作不可撤销，请谨慎操作
- 建议在删除前确认事件确实不再需要
- 如果只是想暂时隐藏事件，可以考虑标记为完成而不是删除

### 手动添加步骤

除了自动生成的步骤，您还可以随时手动添加新步骤：

1. 在事件详情页面，点击"添加步骤"按钮
2. 输入步骤标题（必填）
3. 输入步骤描述（可选）
4. 点击"添加步骤"按钮完成添加
5. 新步骤会自动添加到步骤列表末尾

**提示**：手动添加的步骤和自动生成的步骤功能完全相同，都可以编辑、删除和标记完成。

### 编辑描述并重新生成步骤

如果您需要修改事件描述并根据新描述重新生成步骤：

1. 在事件详情页面，点击右上角的"编辑描述"按钮
2. 在编辑页面修改事件描述
3. 系统会实时显示"智能生成步骤预览"，展示根据新描述生成的步骤
4. 您可以选择：
   - **保存描述**：只更新描述，保留现有步骤
   - **重新生成步骤**：删除所有现有步骤，根据新描述生成新步骤
5. 点击"重新生成步骤"时，系统会提示确认，因为这会删除所有现有步骤
6. 确认后，系统会自动生成新步骤并返回事件详情页

**使用场景**：
- 事件需求发生变化，需要调整执行步骤
- 初始描述不够详细，补充后重新生成更完整的步骤
- 发现步骤不合理，通过修改描述来优化步骤结构

**提示**：重新生成步骤会删除所有现有步骤（包括完成状态），请谨慎操作。

### 一键退出编辑

在编辑事件描述时，您可以使用一键退出功能快速离开编辑页面：

1. 在编辑描述页面的右上角，点击"退出"按钮
2. 系统会自动检测您是否有未保存的修改：
   - **没有修改**：直接返回上一页
   - **有修改**：弹出确认对话框，询问是否保存
3. 在确认对话框中，您可以选择：
   - **保存并退出**：保存当前修改后返回
   - **不保存**：放弃所有修改，直接返回

**使用场景**：
- 编辑到一半想放弃修改
- 快速查看后决定不做修改
- 误操作进入编辑页面
- 完成编辑后快速退出

**提示**：
- 系统会智能判断是否有修改，避免不必要的提示
- 选择"保存并退出"后会自动保存并返回
- 选择"不保存"会立即返回，所有修改将丢失

### 步骤与描述双向同步

系统支持步骤和描述之间的双向同步，确保数据一致性：

#### 自动同步机制

1. **创建事件时**：智能生成的步骤会自动同步到事件描述中
2. **添加步骤时**：新添加的步骤会自动追加到描述末尾
3. **编辑步骤时**：修改步骤标题后，描述中对应的步骤也会更新
4. **删除步骤时**：删除步骤后，描述中对应的步骤也会被移除

#### 手动同步功能

在编辑描述页面，您可以：

1. **查看当前步骤**：页面会显示事件的所有现有步骤
2. **点击"同步到描述"按钮**：将当前所有步骤一键同步到描述框中
3. **手动编辑描述**：在描述中使用列表格式手动添加或删减步骤
   - 支持格式：`1. 步骤内容`、`- 步骤内容`、`* 步骤内容`
4. **重新生成步骤**：根据修改后的描述重新生成步骤列表

#### 使用场景

- **快速调整步骤顺序**：在描述中调整步骤编号，然后重新生成
- **批量添加步骤**：在描述中一次性添加多个步骤，然后重新生成
- **保持数据一致**：确保描述和步骤列表始终保持同步

**提示**：描述格式建议使用数字编号（如 `1. 步骤内容`），这样更清晰易读。

### 智能步骤生成示例

**示例1：列表格式识别**
```
描述：
1. 准备会议材料
2. 发送会议通知
3. 预定会议室
```
系统会自动识别并生成3个步骤。

**示例2：关键词匹配**
```
标题：项目开发
分类：项目开发
```
系统会根据"项目开发"关键词匹配预定义模板，生成相关步骤。

**示例3：发货流程**
```
标题：客户订单发货
分类：发货
```
系统会自动生成完整的发货流程步骤：
1. 客人确认block list
2. 货代配柜+制作T2L
3. 发货+制作delivery note
4. 制作invoice并发给客人+货代+会计师
5. 货代给我MRN和VGM
6. 最终的完整单证给到客人

**提示**：发货步骤也可以在事件详情页手动调整、编辑或删除。

**示例4：进口流程**
```
标题：采购进口设备
分类：进口
```
系统会自动生成完整的进口流程步骤：
1. wanted product list签字
2. 报价单（或者PI）签字
3. 所有支付已完成
4. 已发货
5. 报关中
6. 已收到MRN
7. 已收货

**示例5：机械维修流程**
```
标题：生产线设备维修
分类：机械维修
```
系统会自动生成完整的维修流程步骤：
1. 故障诊断和评估
2. 制定维修方案
3. 采购维修配件
4. 执行维修作业
5. 功能测试和调试
6. 维修记录归档

**示例6：默认步骤**
如果没有明确的列表或关键词，系统会生成通用步骤框架：
- 准备阶段
- 执行阶段
- 验收阶段

## 设计系统

### 配色方案
- 主色调：深蓝色 (#1E3A8A)
- 背景色：浅灰色 (#F8FAFC)
- 警告色：橙红色 (#ED8936)
- 成功色：绿色
- 圆角：8px
- 阴影：柔和阴影效果

### 组件规范
- 使用 Tailwind CSS 进行样式管理
- 遵循 shadcn/ui 设计系统
- 响应式布局，移动优先

## 环境变量

项目使用以下环境变量：

- `TARO_APP_SUPABASE_URL` - Supabase 项目 URL
- `TARO_APP_SUPABASE_ANON_KEY` - Supabase 匿名密钥
- `TARO_APP_NAME` - 应用名称
- `TARO_APP_APP_ID` - 应用 ID

## 如何使用

### 作为网页应用使用

本应用已配置为网页应用（H5），可以直接在浏览器中访问和使用。

#### 部署方式

1. **构建生产版本**
   ```bash
   pnpm install
   pnpm build:h5
   ```

2. **部署到静态托管服务**
   
   构建完成后，`dist` 目录包含所有静态文件，可以部署到任何静态托管服务：
   
   - **Vercel**：直接连接 Git 仓库，自动部署
   - **Netlify**：拖拽 `dist` 目录或连接 Git 仓库
   - **GitHub Pages**：上传 `dist` 目录内容
   - **云服务器**：使用 Nginx 或 Apache 托管 `dist` 目录

3. **本地预览**
   
   如果需要本地预览（仅用于开发测试）：
   ```bash
   # 安装 http-server
   npm install -g http-server
   
   # 在 dist 目录启动服务器
   cd dist
   http-server -p 8080
   ```
   
   然后在浏览器访问 `http://localhost:8080`

#### 环境配置

确保 `.env` 文件中配置了正确的 Supabase 连接信息：

```env
TARO_APP_SUPABASE_URL=your_supabase_url
TARO_APP_SUPABASE_ANON_KEY=your_supabase_anon_key
TARO_APP_NAME=重要事件管理
TARO_APP_APP_ID=your_app_id
```

### 作为微信小程序使用

如果需要在微信小程序中运行：

1. 构建小程序版本：
   ```bash
   pnpm build:weapp
   ```

2. 使用微信开发者工具打开 `dist` 目录

3. 配置小程序 AppID 并上传发布

## 功能特点

### 网页应用特有优势

- ✅ **跨平台访问**：可在任何设备的浏览器中使用
- ✅ **无需安装**：直接通过 URL 访问，无需下载安装
- ✅ **实时更新**：更新即时生效，无需用户手动更新
- ✅ **分享便捷**：通过链接即可分享给他人
- ✅ **SEO 友好**：可被搜索引擎索引（如需要）
- ✅ **桌面端优化**：支持大屏幕显示，操作更便捷

### 核心功能（网页版和小程序版通用）

- 📝 智能事件管理
- 🎯 四象限视图（时间管理矩阵）
- 📊 进度可视化
- 🔔 提醒功能
- 📅 历史记录
- 🔐 用户认证和数据隔离

## 开发说明

1. 所有数据库操作都封装在 `src/db/api.ts` 中
2. 使用 `useAuth` hook 进行用户认证
3. 使用 `useDidShow` hook 确保页面数据实时更新
4. 遵循 Taro 组件规范，使用 `@tarojs/components` 中的组件

## 许可证

MIT
